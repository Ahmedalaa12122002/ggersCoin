<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>GgersCoin</title>

<!-- Telegram WebApp SDK -->
<script src="https://telegram.org/js/telegram-web-app.js"></script>

<style>
body {
    font-family: Arial, sans-serif;
    background: #0f172a;
    color: #fff;
    text-align: center;
    padding-top: 60px;
}
.box {
    background: #020617;
    padding: 25px;
    border-radius: 12px;
    width: 90%;
    max-width: 420px;
    margin: auto;
}
.error {
    color: #ff4d4d;
}
.success {
    color: #4ade80;
}
</style>
</head>

<body>

<div class="box" id="content">
    <h3>ğŸ” Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù‚Ù‚...</h3>
</div>

<script>
/* ============================
   Telegram Check
============================ */
if (!window.Telegram || !Telegram.WebApp) {
    document.body.innerHTML = `
        <h2 style="margin-top:50px">
        âŒ Ù‡Ø°Ø§ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ ÙŠØ¹Ù…Ù„ Ù…Ù† Ø¯Ø§Ø®Ù„ Telegram ÙÙ‚Ø·
        </h2>
    `;
    throw new Error("Not Telegram");
}

const tg = Telegram.WebApp;
tg.ready();

/* ============================
   Device ID (limit accounts)
============================ */
let deviceId = localStorage.getItem("device_id");
if (!deviceId) {
    deviceId = crypto.randomUUID();
    localStorage.setItem("device_id", deviceId);
}

/* ============================
   Auth Request
============================ */
fetch("/api/auth", {
    method: "POST",
    headers: {
        "Content-Type": "application/json"
    },
    body: JSON.stringify({
        initData: tg.initData,
        device_id: deviceId
    })
})
.then(res => res.json())
.then(data => {

    if (data.error) {
        document.getElementById("content").innerHTML = `
            <h3 class="error">âŒ ${data.error}</h3>
        `;
        return;
    }

    document.getElementById("content").innerHTML = `
        <h2 class="success">ğŸ‰ Ù…Ø±Ø­Ø¨Ù‹Ø§ ${data.username || ""}</h2>
        <p>âœ… ØªÙ… ØªØ£Ù…ÙŠÙ† Ø­Ø³Ø§Ø¨Ùƒ Ø¨Ù†Ø¬Ø§Ø­</p>

        <hr style="margin:20px 0">

        <p>ğŸŒ± Ù„Ø¹Ø¨Ø© Ø§Ù„Ù…Ø²Ø±Ø¹Ø© Ù‚ÙŠØ¯ Ø§Ù„ØªØ·ÙˆÙŠØ±</p>
        <p>ğŸ”¥ Ù‚Ø±ÙŠØ¨Ù‹Ø§ Ø£Ù†Ø¸Ù…Ø© Ù„Ø¹Ø¨ ÙˆØ±Ø¨Ø­</p>
    `;
})
.catch(() => {
    document.getElementById("content").innerHTML = `
        <h3 class="error">
        âŒ ÙØ´Ù„ Ø§Ù„ØªØ­Ù‚Ù‚<br>
        Ø§ÙØªØ­ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ù…Ù† Telegram ÙÙ‚Ø·
        </h3>
    `;
});
</script>

</body>
</html>
