<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>GgersCoin</title>
<script src="https://telegram.org/js/telegram-web-app.js"></script>
</head>
<body>

<h3>ğŸ” Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù‚Ù‚...</h3>

<script>
const tg = window.Telegram.WebApp;
tg.ready();

// Ø¥Ù†Ø´Ø§Ø¡ Device ID Ø«Ø§Ø¨Øª
let deviceId = localStorage.getItem("device_id");
if (!deviceId) {
  deviceId = crypto.randomUUID();
  localStorage.setItem("device_id", deviceId);
}

fetch("/api/auth", {
  method: "POST",
  headers: {"Content-Type": "application/json"},
  body: JSON.stringify({
    initData: tg.initData,
    device_id: deviceId
  })
})
.then(r => r.json())
.then(res => {
  if (res.error) {
    document.body.innerHTML = `<h2>âŒ ${res.error}</h2>`;
  } else {
    document.body.innerHTML = `
      <h2>ğŸ‰ Ù…Ø±Ø­Ø¨Ù‹Ø§ ${res.username || ""}</h2>
      <p>ØªÙ… ØªØ£Ù…ÙŠÙ† Ø­Ø³Ø§Ø¨Ùƒ Ø¨Ù†Ø¬Ø§Ø­</p>
    `;
  }
})
.catch(() => {
  document.body.innerHTML = "<h2>âŒ Ø§ÙØªØ­ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ù…Ù† Telegram ÙÙ‚Ø·</h2>";
});
</script>

</body>
</html>
