<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>WinHive</title>

<script src="https://telegram.org/js/telegram-web-app.js"></script>

<style>
*{
  box-sizing:border-box;
  margin:0;
  padding:0;
  font-family:system-ui;
}

body{
  background:#000;
  color:#fff;
  overflow:hidden;
}

/* ===== CONTENT ===== */
#content{
  height:calc(100vh - 110px);
  padding:20px;
  overflow:hidden;
  transition:opacity .3s ease, transform .3s ease;
}

/* ===== NAV BAR ===== */
.nav-bar{
  position:fixed;
  bottom:0;
  width:100%;
  height:110px;
  background:rgba(15,15,15,.96);
  backdrop-filter:blur(12px);
  display:flex;
  justify-content:space-around;
  align-items:center;
  border-top:1px solid #222;
}

/* ===== NAV BUTTON ===== */
.nav-btn{
  width:56px;
  height:56px;
  border-radius:50%;
  background:#141414;
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  color:#aaa;
  font-size:11px;
  transition:.25s;
}

.nav-btn .icon{
  font-size:18px;
  margin-bottom:3px;
}

/* ===== HOME BUTTON ===== */
.home-btn{
  width:78px;
  height:78px;
  margin-top:-18px;
}

.home-btn .icon{
  font-size:30px;
}

/* ===== ACTIVE ===== */
.nav-btn.active{
  color:#fff;
  box-shadow:
    0 0 16px rgba(255,200,0,.35),
    0 0 28px rgba(255,200,0,.15);
}

.nav-btn:active{
  transform:scale(.92);
}

/* ===== CARD ===== */
.card{
  background:#0e0e0e;
  border-radius:20px;
  padding:18px;
  margin-bottom:15px;
}

.header{
  display:flex;
  justify-content:space-between;
  font-size:14px;
}

.center{text-align:center}

/* ===== FARM GRID ===== */
.farm{
  display:grid;
  gap:12px;
  margin-top:15px;
}

.plot{
  background:#1a1a1a;
  border-radius:14px;
  height:90px;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:28px;
  cursor:pointer;
}

/* ===== TASK ===== */
.task{
  background:#111;
  border-radius:14px;
  padding:14px;
  margin-top:12px;
  font-size:14px;
}
.task span{color:#ffcc00}
</style>
</head>

<body>

<div id="content"></div>

<!-- ===== NAV BAR (7 MENUS) ===== -->
<div class="nav-bar">

  <div class="nav-btn" onclick="go('settings',this)">
    <div class="icon">âš™ï¸</div>Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
  </div>

  <div class="nav-btn" onclick="go('vip',this)">
    <div class="icon">â­</div>VIP
  </div>

  <div class="nav-btn" onclick="go('wallet',this)">
    <div class="icon">ğŸ’¼</div>Ø§Ù„Ù…Ø­ÙØ¸Ø©
  </div>

  <div class="nav-btn home-btn active" onclick="go('home',this)">
    <div class="icon">ğŸ </div>Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
  </div>

  <div class="nav-btn" onclick="go('tasks',this)">
    <div class="icon">ğŸ“‹</div>Ø§Ù„Ù…Ù‡Ø§Ù…
  </div>

  <div class="nav-btn" onclick="go('ref',this)">
    <div class="icon">ğŸ‘¥</div>Ø§Ù„Ø¥Ø­Ø§Ù„Ø©
  </div>

  <div class="nav-btn" onclick="go('logs',this)">
    <div class="icon">ğŸ§¾</div>Ø§Ù„Ø³Ø¬Ù„Ø§Øª
  </div>

                         </div>
  <script>
/* ===============================
   TELEGRAM INIT
================================ */
Telegram.WebApp.ready();

/* ===============================
   NAV STATE
================================ */
let currentPage = 'home';

/* ===============================
   PAGES PLACEHOLDERS
   (Ø³ÙŠØªÙ… Ø§Ø³ØªØ¨Ø¯Ø§Ù„ home Ù„Ø§Ø­Ù‚Ù‹Ø§)
================================ */
const pages = {
  home: `
    <div class="card center">
      <h2>ğŸŒ¾ WinHive</h2>
      <div style="opacity:.6;margin-top:8px">Ø¬Ø§Ø±Ù ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø²Ø±Ø¹Ø©â€¦</div>
    </div>
  `,
  tasks: `
    <div class="card center">
      <h3>ğŸ“‹ Ø§Ù„Ù…Ù‡Ø§Ù…</h3>
      <div style="opacity:.6">Ù‚Ø±ÙŠØ¨Ù‹Ø§</div>
    </div>
  `,
  wallet: `
    <div class="card center">
      <h3>ğŸ’¼ Ø§Ù„Ù…Ø­ÙØ¸Ø©</h3>
      <div style="opacity:.6">Ù‚Ø±ÙŠØ¨Ù‹Ø§</div>
    </div>
  `,
  vip: `
    <div class="card center">
      <h3>â­ VIP</h3>
      <div style="opacity:.6">Ù‚Ø±ÙŠØ¨Ù‹Ø§</div>
    </div>
  `,
  ref: `
    <div class="card center">
      <h3>ğŸ‘¥ Ø§Ù„Ø¥Ø­Ø§Ù„Ø©</h3>
      <div style="opacity:.6">Ù‚Ø±ÙŠØ¨Ù‹Ø§</div>
    </div>
  `,
  logs: `
    <div class="card center">
      <h3>ğŸ§¾ Ø§Ù„Ø³Ø¬Ù„Ø§Øª</h3>
      <div style="opacity:.6">Ù‚Ø±ÙŠØ¨Ù‹Ø§</div>
    </div>
  `,
  settings: `
    <div class="card center">
      <h3>âš™ï¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</h3>
      <div style="opacity:.6">Ù‚Ø±ÙŠØ¨Ù‹Ø§</div>
    </div>
  `
};

/* ===============================
   NAV FUNCTION
================================ */
function go(page, el){
  if(page === currentPage) return;
  currentPage = page;

  document.querySelectorAll('.nav-btn')
    .forEach(b => b.classList.remove('active'));
  if(el) el.classList.add('active');

  const c = document.getElementById('content');
  c.style.opacity = 0;
  c.style.transform = 'translateY(10px)';

  setTimeout(() => {
    c.innerHTML = pages[page] || pages.home;
    c.style.opacity = 1;
    c.style.transform = 'translateY(0)';
  }, 180);
}

/* ===============================
   LOAD HOME FIRST
================================ */
document.getElementById('content').innerHTML = pages.home;
  </script>
  <script>
/* ===============================
   PHASE 1 â€“ LAND SYSTEM
================================ */

// Ù…Ø³ØªÙˆÙ‰ VIP (Ø§ÙØªØ±Ø§Ø¶ÙŠ 0)
let vipLevel = Number(localStorage.getItem("vipLevel") || 0);

// Ø§Ù„Ù†Ù‚Ø§Ø· (Ø³ØªÙØ³ØªØ®Ø¯Ù… Ù„Ø§Ø­Ù‚Ù‹Ø§)
let points = Number(localStorage.getItem("points") || 0);

// Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø±Ø§Ø¶ÙŠ Ø§Ù„ÙƒÙ„ÙŠ
const TOTAL_PLOTS = 6;

// Ø­Ø§Ù„Ø© ÙƒÙ„ Ø£Ø±Ø¶:
// 0 = ÙØ§Ø¶ÙŠØ©
// 1 = Ù…Ø²Ø±ÙˆØ¹Ø© (Ù‚ÙŠØ¯ Ø§Ù„Ù†Ù…Ùˆ)
// 2 = Ø¬Ø§Ù‡Ø²Ø© Ù„Ù„Ø­ØµØ§Ø¯
let plots = JSON.parse(
  localStorage.getItem("plots") ||
  JSON.stringify(Array(TOTAL_PLOTS).fill(0))
);

// Ø­Ø³Ø§Ø¨ Ø§Ù„Ø£Ø±Ø§Ø¶ÙŠ Ø§Ù„Ù…ÙØªÙˆØ­Ø© Ø­Ø³Ø¨ VIP
function unlockedPlots(){
  return Math.min(1 + vipLevel, TOTAL_PLOTS);
}

/* ===============================
   HOME PAGE (OVERRIDE)
================================ */
pages.home = function(){
  let openCount = unlockedPlots();

  return `
  <div class="card">
    <div class="header">
      <div>ğŸ’° Ø§Ù„Ù†Ù‚Ø§Ø·: ${points}</div>
      <div>ğŸ‘‘ VIP: ${vipLevel}</div>
    </div>

    <div class="center" style="margin:10px 0">
      <h2>ğŸŒ¾ WinHive</h2>
      <div style="opacity:.6;font-size:13px">
        Ø£Ø±Ø§Ø¶ÙŠ Ù…ÙØªÙˆØ­Ø©: ${openCount} / ${TOTAL_PLOTS}
      </div>
    </div>

    <div class="farm" style="grid-template-columns:repeat(3,1fr)">
      ${plots.map((state,i)=>{
        if(i < openCount){
          return `
            <div class="plot" onclick="plotClick(${i})">
              ğŸŸ«
            </div>
          `;
        }else{
          return `
            <div class="plot" style="opacity:.35;cursor:not-allowed">
              ğŸ”’
            </div>
          `;
        }
      }).join("")}
    </div>

    <div class="task">
      ğŸ”’ Ø§ÙØªØ­ Ø£Ø±Ø§Ø¶ÙŠ Ø¥Ø¶Ø§ÙÙŠØ© Ø¹Ù† Ø·Ø±ÙŠÙ‚ ØªØ±Ù‚ÙŠØ© VIP
    </div>
  </div>
  `;
};

/* ===============================
   CLICK PLACEHOLDER
   (Ø³ÙŠØªÙ… ØªØ·ÙˆÙŠØ±Ù‡ Ø¨Ø§Ù„Ø¬Ø²Ø¡ 4)
================================ */
function plotClick(index){
  alert("ğŸŒ± Ø§Ù„Ø²Ø±Ø§Ø¹Ø© Ø³ØªØªÙˆÙØ± ÙÙŠ Ø§Ù„Ø®Ø·ÙˆØ© Ø§Ù„ØªØ§Ù„ÙŠØ©");
}

/* ===============================
   INITIAL RENDER UPDATE
================================ */
document.getElementById("content").innerHTML = pages.home();
  </script>
  <script>
/* ===============================
   PHASE 1 â€“ FARMING (WHEAT)
================================ */

// ÙˆÙ‚Øª Ø²Ø±Ø§Ø¹Ø© Ø§Ù„Ù‚Ù…Ø­ (ØªØ¬Ø±Ø¨Ø©: 30 Ø«Ø§Ù†ÙŠØ©)
const WHEAT_TIME = 30 * 1000; // 5 Ø¯Ù‚Ø§Ø¦Ù‚ = 5 * 60 * 1000

// Ø£ÙˆÙ‚Ø§Øª Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø²Ø±Ø§Ø¹Ø© Ù„ÙƒÙ„ Ø£Ø±Ø¶
let growTimers = JSON.parse(
  localStorage.getItem("growTimers") ||
  JSON.stringify(Array(TOTAL_PLOTS).fill(null))
);

/* ===============================
   UPDATE HOME PAGE (OVERRIDE)
================================ */
pages.home = function(){
  let openCount = unlockedPlots();
  let now = Date.now();

  return `
  <div class="card">
    <div class="header">
      <div>ğŸ’° Ø§Ù„Ù†Ù‚Ø§Ø·: ${points}</div>
      <div>ğŸ‘‘ VIP: ${vipLevel}</div>
    </div>

    <div class="center" style="margin:10px 0">
      <h2>ğŸŒ¾ WinHive</h2>
      <div style="opacity:.6;font-size:13px">
        Ù…Ø²Ø±Ø¹Ø© Ø§Ù„Ù‚Ù…Ø­ â€” Ø£Ø±Ø§Ø¶ÙŠ Ù…ÙØªÙˆØ­Ø©: ${openCount}/${TOTAL_PLOTS}
      </div>
    </div>

    <div class="farm" style="grid-template-columns:repeat(3,1fr)">
      ${plots.map((state,i)=>{
        if(i >= openCount){
          return `<div class="plot" style="opacity:.35">ğŸ”’</div>`;
        }

        // Ø£Ø±Ø¶ ÙØ§Ø¶ÙŠØ©
        if(state === 0){
          return `<div class="plot" onclick="plant(${i})">ğŸŸ«</div>`;
        }

        // Ù…Ø²Ø±ÙˆØ¹Ø© (Ù‚ÙŠØ¯ Ø§Ù„Ù†Ù…Ùˆ)
        if(state === 1){
          let left = Math.max(0, Math.ceil((growTimers[i]-now)/1000));
          return `<div class="plot">ğŸŒ±<div style="font-size:11px">${left}s</div></div>`;
        }

        // Ø¬Ø§Ù‡Ø²Ø© Ù„Ù„Ø­ØµØ§Ø¯
        return `<div class="plot" onclick="harvest(${i})">ğŸŒ¾</div>`;
      }).join("")}
    </div>

    <div class="task">
      ğŸŒ± Ø§Ø²Ø±Ø¹ Ø§Ù„Ù‚Ù…Ø­ ÙˆØ§Ù†ØªØ¸Ø± Ø­ØªÙ‰ ÙŠØ¬Ù‡Ø² Ù„Ù„Ø­ØµØ§Ø¯
    </div>
  </div>
  `;
};

/* ===============================
   PLANT WHEAT
================================ */
function plant(index){
  if(plots[index] !== 0) return;

  plots[index] = 1;
  growTimers[index] = Date.now() + WHEAT_TIME;

  saveFarm();
  refreshHome();
}

/* ===============================
   CHECK GROWTH
================================ */
function checkGrowth(){
  let now = Date.now();
  let changed = false;

  plots.forEach((state,i)=>{
    if(state === 1 && growTimers[i] <= now){
      plots[i] = 2; // Ø¬Ø§Ù‡Ø² Ù„Ù„Ø­ØµØ§Ø¯
      growTimers[i] = null;
      changed = true;
    }
  });

  if(changed){
    saveFarm();
    refreshHome();
  }
}

/* ===============================
   SAVE & REFRESH
================================ */
function saveFarm(){
  localStorage.setItem("plots", JSON.stringify(plots));
  localStorage.setItem("growTimers", JSON.stringify(growTimers));
}

function refreshHome(){
  if(currentPage === "home"){
    document.getElementById("content").innerHTML = pages.home();
  }
}

/* ===============================
   AUTO CHECK TIMER
================================ */
setInterval(checkGrowth, 1000);
  </script>
  <script>
/* ===============================
   PHASE 1 â€“ HARVEST & TASKS
================================ */

// Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ù‡Ø§Ù…
let taskState = JSON.parse(
  localStorage.getItem("taskState") ||
  JSON.stringify({
    type: "harvest", // harvest / plant
    target: 5,
    progress: 0,
    reward: 10
  })
);

/* ===============================
   HARVEST
================================ */
function harvest(index){
  if(plots[index] !== 2) return;

  // Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø£Ø±Ø¶ ÙØ§Ø¶ÙŠØ©
  plots[index] = 0;

  // Ù†Ù‚Ø§Ø· Ø§Ù„Ø­ØµØ§Ø¯ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©
  points += 1;

  // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ù‡Ù…Ø©
  if(taskState.type === "harvest"){
    taskState.progress += 1;
    if(taskState.progress >= taskState.target){
      points += taskState.reward;
      nextTask();
    }
  }

  saveAll();
  refreshHome();
}

/* ===============================
   NEXT TASK
================================ */
function nextTask(){
  // Ø§Ù„ØªØ¨Ø¯ÙŠÙ„ Ø¨ÙŠÙ† Ù…Ù‡Ø§Ù… Ø§Ù„Ø²Ø±Ø§Ø¹Ø© ÙˆØ§Ù„Ø­ØµØ§Ø¯
  if(taskState.type === "harvest"){
    taskState = {
      type: "plant",
      target: 3,
      progress: 0,
      reward: 5
    };
  }else{
    taskState = {
      type: "harvest",
      target: 5,
      progress: 0,
      reward: 10
    };
  }
}

/* ===============================
   OVERRIDE TASK DISPLAY
================================ */
const oldHome = pages.home;
pages.home = function(){
  let html = oldHome();

  let taskText =
    taskState.type === "harvest"
    ? `Ø§Ø­ØµØ¯ ${taskState.target} Ù…Ø±Ø§Øª`
    : `Ø§Ø²Ø±Ø¹ ${taskState.target} Ù…Ø±Ø§Øª`;

  html = html.replace(
    '</div>\n\n    <div class="task">',
    `</div>
    <div class="task">
      ğŸ¯ Ø§Ù„Ù…Ù‡Ù…Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©: <span>${taskText}</span><br>
      Ø§Ù„ØªÙ‚Ø¯Ù…: ${taskState.progress} / ${taskState.target}<br>
      Ø§Ù„Ù…ÙƒØ§ÙØ£Ø©: ${taskState.reward} Ù†Ù‚Ø·Ø©
    </div>`
  );

  return html;
};

/* ===============================
   PLANT TASK TRACKING
================================ */
const oldPlant = plant;
plant = function(index){
  if(plots[index] !== 0) return;

  plots[index] = 1;
  growTimers[index] = Date.now() + WHEAT_TIME;

  if(taskState.type === "plant"){
    taskState.progress += 1;
    if(taskState.progress >= taskState.target){
      points += taskState.reward;
      nextTask();
    }
  }

  saveAll();
  refreshHome();
};

/* ===============================
   SAVE ALL
================================ */
function saveAll(){
  localStorage.setItem("plots", JSON.stringify(plots));
  localStorage.setItem("growTimers", JSON.stringify(growTimers));
  localStorage.setItem("points", points);
  localStorage.setItem("taskState", JSON.stringify(taskState));
}
  </script>
